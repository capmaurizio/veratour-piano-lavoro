# PROSPETTO CALCOLO ALPITOUR 2025

## üìã SOMMARIO REGOLE

### 1. TARIFFE BASE TURNO

#### Bergamo Orio al Serio (BGY)
| Durata | Tariffa Netta | Tariffa + IVA 22% |
|--------|---------------|-------------------|
| 3 ore  | ‚Ç¨75,00       | ‚Ç¨91,50           |
| 4 ore  | ‚Ç¨90,00       | ‚Ç¨109,80          |
| 5 ore  | ‚Ç¨105,00      | ‚Ç¨128,10          |
| 6 ore  | ‚Ç¨120,00      | ‚Ç¨146,40          |
| 7 ore  | ‚Ç¨135,00      | ‚Ç¨164,70          |
| 8 ore  | ‚Ç¨150,00      | ‚Ç¨183,00          |

**Oltre 3h:** +‚Ç¨15,00/ora (pro-rata al minuto)

#### Verona Catullo (VRN)
| Durata | Tariffa Netta | Tariffa + IVA 22% |
|--------|---------------|-------------------|
| 3 ore  | ‚Ç¨80,00       | ‚Ç¨97,60           |
| 4 ore  | ‚Ç¨95,00       | ‚Ç¨115,90          |
| 5 ore  | ‚Ç¨110,00      | ‚Ç¨134,20          |
| 6 ore  | ‚Ç¨125,00      | ‚Ç¨152,50          |
| 7 ore  | ‚Ç¨140,00      | ‚Ç¨171,00          |
| 8 ore  | ‚Ç¨155,00      | ‚Ç¨189,10          |

**Oltre 3h:** +‚Ç¨15,00/ora (pro-rata al minuto)

---

### 2. TARIFFE AGGIUNTIVE E MAGGIORAZIONI

#### Ore Extra (oltre turno)
- **Tariffa:** ‚Ç¨20,00/ora + IVA
- **Calcolo:** Ultimo ATD (o STD se ATD non disponibile) + 30 minuti > fine turno
  - Se ATD √® **dopo** fine turno: extra = (ATD + 30 min) - fine turno
  - Se ATD √® **prima** fine turno: dei 30 minuti post-ATD, solo la parte che va oltre fine turno conta come extra
  - Esempio: ATD 10:24, fine turno 10:25 ‚Üí 1 min dentro turno, 29 min extra (10:25-10:54)
- **Arrotondamento:** **NESSUNO** - si usano i minuti esatti calcolati

#### Ore dentro turno oltre le prime 3h
- **Tariffa:** ‚Ç¨15,00/ora + IVA
- **Calcolo:** Applicato automaticamente nel calcolo del turno se durata > 3h

#### Notturno (23:00-06:00)
- **Fascia oraria:** 23:00 - 06:00
- **Calcolo:** Applicato solo ai minuti effettivamente lavorati nella fascia 23:00-06:00 (su turno + extra)
- **Arrotondamento:** **NESSUNO** - si usano i minuti esatti calcolati

**Bergamo (BGY)**:
- Base: ‚Ç¨75,00 per 3h = ‚Ç¨25,00/ora
- Maggiorazione 15%: ‚Ç¨25,00/ora √ó 1.15 = ‚Ç¨28,75/ora
- Differenza notturna: ‚Ç¨28,75/ora - ‚Ç¨25,00/ora = **‚Ç¨3,75/ora = ‚Ç¨0,0625/minuto**

**Verona (VRN)**:
- Base: ‚Ç¨80,00 per 3h = ‚Ç¨26,67/ora
- Maggiorazione 15%: ‚Ç¨26,67/ora √ó 1.15 = ‚Ç¨30,67/ora
- Differenza notturna: ‚Ç¨30,67/ora - ‚Ç¨26,67/ora = **‚Ç¨4,00/ora = ‚Ç¨0,0667/minuto**
- **Nessun minimo**: calcolo proporzionale puro

#### Festivi Ufficiali
- **Maggiorazione:** +20% su **turno, extra E notturno** (applicato a tutto)
- **Festivi 2025:**
  - 1 Gennaio (Capodanno)
  - 6 Gennaio (Epifania)
  - 25 Aprile (Liberazione)
  - 1 Maggio (Festa del Lavoro)
  - 2 Giugno (Festa della Repubblica)
  - 15 Agosto (Ferragosto)
  - 1 Novembre (Ognissanti)
  - 8 Dicembre (Immacolata)
  - 25 Dicembre (Natale)
  - 26 Dicembre (Santo Stefano)
  - Pasqua 2025 (20 Aprile)
  - Pasquetta 2025 (21 Aprile)

---

## üî¢ ESEMPI DI CALCOLO

### Esempio 1: Turno Standard BGY (Non Festivo)

**Dati:**
- **Aeroporto:** BGY
- **Turno:** 07:00-11:00 (4 ore)
- **ATD:** 11:15
- **Festivo:** No

**Calcoli:**
1. **Turno:**
   - Durata: 4 ore ‚Üí Tariffa fissa: **‚Ç¨90,00**

2. **Extra:**
   - Fine copertura: 11:15 + 30 min = 11:45
   - Fine turno: 11:00
   - Extra raw: 11:45 - 11:00 = 45 minuti
   - Arrotondamento: 45 min (gi√† multiplo di 5)
   - Extra ‚Ç¨: (45/60) √ó ‚Ç¨20,00 = **‚Ç¨15,00**

3. **Notturno:**
   - Turno: 07:00-11:00 (fuori fascia 23:00-06:00)
   - Extra: 11:00-11:45 (fuori fascia 23:00-06:00)
   - Notturno: **0 minuti** ‚Üí **‚Ç¨0,00**

4. **Festivo:**
   - No ‚Üí Nessuna maggiorazione

**TOTALE: ‚Ç¨90,00 + ‚Ç¨15,00 + ‚Ç¨0,00 = ‚Ç¨105,00**

---

### Esempio 2: Turno con Notturno BGY

**Dati:**
- **Aeroporto:** BGY
- **Turno:** 23:30-02:30 (3 ore, attraversa mezzanotte)
- **ATD:** 02:45
- **Festivo:** No

**Calcoli:**
1. **Turno:**
   - Durata: 3 ore ‚Üí Tariffa fissa: **‚Ç¨75,00**

2. **Extra:**
   - Fine copertura: 02:45 + 30 min = 03:15
   - Fine turno: 02:30
   - Extra raw: 03:15 - 02:30 = 45 minuti
   - Arrotondamento: 45 min
   - Extra ‚Ç¨: (45/60) √ó ‚Ç¨20,00 = **‚Ç¨15,00**

3. **Notturno:**
   - Turno: 23:30-02:30
     - Minuti notturni turno: 23:30-06:00 = 2h30min = 150 minuti
   - Extra: 02:30-03:15
     - Minuti notturni extra: 02:30-03:15 = 45 minuti
   - Totale notturno: 150 + 45 = 195 minuti
   - Notturno ‚Ç¨: 195 √ó ‚Ç¨0,0625 = **‚Ç¨12,19**

4. **Festivo:**
   - No ‚Üí Nessuna maggiorazione

**TOTALE: ‚Ç¨75,00 + ‚Ç¨15,00 + ‚Ç¨12,19 = ‚Ç¨102,19**

---

### Esempio 3: Turno VRN con Durata Non Standard (Pro-rata)

**Dati:**
- **Aeroporto:** VRN
- **Turno:** 11:00-16:30 (5h30min = 330 minuti)
- **ATD:** 17:20
- **Festivo:** No

**Calcoli:**
1. **Turno:**
   - Durata: 5h30min (non √® una durata standard)
   - Base 3h: ‚Ç¨80,00
   - Ore oltre 3h: 5,5 - 3 = 2,5 ore
   - Pro-rata: ‚Ç¨80,00 + (2,5 √ó ‚Ç¨15,00) = ‚Ç¨80,00 + ‚Ç¨37,50 = **‚Ç¨117,50**

2. **Extra:**
   - Fine copertura: 17:20 + 30 min = 17:50
   - Fine turno: 16:30
   - Extra raw: 17:50 - 16:30 = 80 minuti
   - Arrotondamento: 80 min (gi√† multiplo di 5)
   - Extra ‚Ç¨: (80/60) √ó ‚Ç¨20,00 = **‚Ç¨26,67**

3. **Notturno:**
   - Turno: 11:00-16:30 (fuori fascia)
   - Extra: 16:30-17:50 (fuori fascia)
   - Notturno: **0 minuti** ‚Üí **‚Ç¨0,00**

4. **Festivo:**
   - No ‚Üí Nessuna maggiorazione

**TOTALE: ‚Ç¨117,50 + ‚Ç¨26,67 + ‚Ç¨0,00 = ‚Ç¨144,17**

---

### Esempio 4: Turno Festivo BGY con Extra

**Dati:**
- **Aeroporto:** BGY
- **Turno:** 09:00-13:00 (4 ore)
- **ATD:** 13:25
- **Festivo:** S√¨ (es. 25 Aprile)

**Calcoli:**
1. **Turno:**
   - Durata: 4 ore ‚Üí Tariffa fissa: ‚Ç¨90,00
   - Festivo: ‚Ç¨90,00 √ó 1,20 = **‚Ç¨108,00**

2. **Extra:**
   - Fine copertura: 13:25 + 30 min = 13:55
   - Fine turno: 13:00
   - Extra raw: 13:55 - 13:00 = 55 minuti
   - Arrotondamento: 55 min (gi√† multiplo di 5)
   - Extra base: (55/60) √ó ‚Ç¨20,00 = ‚Ç¨18,33
   - Festivo: ‚Ç¨18,33 √ó 1,20 = **‚Ç¨22,00**

3. **Notturno:**
   - Turno: 09:00-13:00 (fuori fascia)
   - Extra: 13:00-13:55 (fuori fascia)
   - Notturno: **0 minuti** ‚Üí **‚Ç¨0,00**
   - **NOTA:** Il notturno NON ha maggiorazione festiva

4. **Festivo:**
   - Applicato su turno e extra

**TOTALE: ‚Ç¨108,00 + ‚Ç¨22,00 + ‚Ç¨0,00 = ‚Ç¨130,00**

---

### Esempio 5: Turno con "NO DEC"

**Dati:**
- **Aeroporto:** VRN
- **Turno:** 14:00-18:00 (4 ore) con "NO DEC"
- **ATD:** 18:30
- **Festivo:** No

**Calcoli:**
1. **Turno:**
   - Durata: 4 ore ‚Üí Tariffa fissa: **‚Ç¨95,00**

2. **Extra:**
   - **"NO DEC" presente ‚Üí Extra = 0 minuti**
   - Extra ‚Ç¨: **‚Ç¨0,00**

3. **Notturno:**
   - Turno: 14:00-18:00 (fuori fascia)
   - Extra: 0 (non calcolato per NO DEC)
   - Notturno: **0 minuti** ‚Üí **‚Ç¨0,00**

**TOTALE: ‚Ç¨95,00 + ‚Ç¨0,00 + ‚Ç¨0,00 = ‚Ç¨95,00**

---

### Esempio 6: Calcolo Extra (senza arrotondamento)

**Dati:**
- **Aeroporto:** BGY
- **Turno:** 10:00-14:00 (4 ore)
- **ATD:** 14:12
- **Festivo:** No

**Calcoli:**
1. **Turno:**
   - Durata: 4 ore ‚Üí Tariffa fissa: **‚Ç¨90,00**

2. **Extra:**
   - Fine copertura: 14:12 + 30 min = 14:42
   - Fine turno: 14:00
   - Extra raw: 14:42 - 14:00 = **42 minuti**
   - **NESSUN arrotondamento:** si usano i 42 minuti esatti
   - Extra ‚Ç¨: (42/60) √ó ‚Ç¨20,00 = **‚Ç¨14,00**

3. **Notturno:**
   - Turno: 10:00-14:00 (fuori fascia)
   - Extra: 14:00-14:42 (fuori fascia)
   - Notturno: **0 minuti** ‚Üí **‚Ç¨0,00**

**TOTALE: ‚Ç¨90,00 + ‚Ç¨14,00 + ‚Ç¨0,00 = ‚Ç¨104,00**

---

### Esempio 7: VRN con Notturno e Festivo

**Dati:**
- **Aeroporto:** VRN
- **Turno:** 04:30-12:00 (7,5 ore)
- **ATD:** 11:37
- **Festivo:** S√¨ (8 Dicembre - Immacolata)

**Calcoli:**
1. **Turno:**
   - Durata: 7,5 ore
   - Base 3h: ‚Ç¨80,00
   - Ore oltre 3h: 4,5 ore √ó ‚Ç¨15,00/ora = ‚Ç¨67,50
   - Turno base: ‚Ç¨80,00 + ‚Ç¨67,50 = **‚Ç¨147,50**

2. **Extra:**
   - Fine copertura: 11:37 + 30 min = 12:07
   - Fine turno: 12:00
   - Extra raw: 12:07 - 12:00 = **7 minuti**
   - **NESSUN arrotondamento:** si usano i 7 minuti esatti
   - Extra base: (7/60) √ó ‚Ç¨20,00 = **‚Ç¨2,33**

3. **Notturno:**
   - Turno: 04:30-12:00
   - Minuti notturni: 04:30-06:00 = **90 minuti** (1,5 ore)
   - **Calcolo VRN:** Base ‚Ç¨80,00/3h = ‚Ç¨26,67/ora
   - Maggiorazione 15%: ‚Ç¨26,67/ora √ó 1.15 = ‚Ç¨30,67/ora
   - Differenza notturna: ‚Ç¨30,67/ora - ‚Ç¨26,67/ora = **‚Ç¨4,00/ora**
   - Notturno base: 1,5 ore √ó ‚Ç¨4,00/ora = **‚Ç¨6,00**
   - **Nessun minimo:** calcolo proporzionale puro

4. **Festivo (+20% su tutto):**
   - Turno festivo: ‚Ç¨147,50 √ó 1.20 = **‚Ç¨177,00**
   - Extra festivo: ‚Ç¨2,33 √ó 1.20 = **‚Ç¨2,80**
   - Notturno festivo: ‚Ç¨6,00 √ó 1.20 = **‚Ç¨7,20**

**TOTALE: ‚Ç¨177,00 + ‚Ç¨2,80 + ‚Ç¨7,20 = ‚Ç¨187,00**

---

## üìä FORMULE DI CALCOLO

### Turno (‚Ç¨)
```
Se durata = 3h, 4h, 5h, 6h, 7h, 8h:
  ‚Üí Usa tariffa fissa corrispondente

Altrimenti:
  ‚Üí Base 3h + (ore_oltre_3h √ó ‚Ç¨15,00)
```

### Extra (‚Ç¨)
```
Fine copertura = Ultimo ATD (o STD) + 30 minuti
Extra raw = max(0, Fine copertura - Fine turno)
  - Se ATD √® dopo fine turno: extra = (ATD + 30 min) - fine turno
  - Se ATD √® prima fine turno: dei 30 minuti post-ATD, solo la parte oltre fine turno conta
Extra ‚Ç¨ = (Extra raw / 60) √ó ‚Ç¨20,00
  - NESSUN arrotondamento: si usano i minuti esatti

Se "NO DEC" presente ‚Üí Extra = 0
```

### Notturno (‚Ç¨)
```
Minuti notturni = minuti in fascia 23:00-06:00
  (calcolati su turno + extra se presente)
  - NESSUN arrotondamento: si usano i minuti esatti

BGY: Notturno ‚Ç¨ = Minuti notturni √ó ‚Ç¨0,0625/minuto
VRN: Notturno ‚Ç¨ = Minuti notturni √ó ‚Ç¨0,0667/minuto (4‚Ç¨/ora)
  - Nessun minimo per VRN: calcolo proporzionale puro
```

### Festivo
```
Se festivo:
  Turno festivo = Turno √ó 1,20
  Extra festivo = Extra √ó 1,20
  Notturno festivo = Notturno √ó 1,20
  (La maggiorazione +20% si applica a TUTTO: turno, extra e notturno)
```

### Totale
```
Totale = Turno (con festivo se applicabile) + 
         Extra (con festivo se applicabile) + 
         Notturno
```

---

## üîç REGOLE SPECIALI

### 1. Gestione Blocchi
- Un blocco √® definito da: **DATA + APT + TURNO normalizzato**
- Tutte le righe dello stesso blocco rappresentano un unico servizio
- Solo la prima riga del blocco riporta i valori calcolati

### 2. Forward-Fill TURNO
- Il campo TURNO viene "riempito in avanti" (forward-fill) per DATA
- Se una riga non ha TURNO, usa quello della riga precedente con stessa DATA

### 3. Selezione Decollo
- **Priorit√† 1:** Ultimo ATD disponibile dopo fine turno
- **Priorit√† 2:** Ultimo STD disponibile dopo fine turno (se ATD non disponibile)
- Se nessuno disponibile ‚Üí Extra = 0

### 4. Parsing TURNO
- Ignora prefissi (SC1, SC2, AB, ecc.)
- Supporta formati: `7-11:30`, `07:10-11:10`, `11.00-16:30`, `SC1:16-19:30`
- Gestisce attraversamento mezzanotte (es. `23:30-02:30`)

### 5. Fine Turno Effettivo
- La colonna "Fine Turno" riporta l'orario effettivo utilizzato per il calcolo extra
- Fine Turno = ATD (o STD) + 30 minuti

---

## üìù ASSISTENTI VRN

Per gli assistenti VRN, le tariffe sono le stesse di Veratour:

- **Base:** ‚Ç¨58,00 per 3 ore
- **Oltre 3h:** +‚Ç¨12,00/ora
- **Extra:** ‚Ç¨12,00/ora
- **Notturno:** +15% proporzionale (calcolato come Veratour)
- **Festivi:** +20% su (base + extra + notturno)

Vedi documentazione Veratour per dettagli completi.

---

## üìÑ OUTPUT EXCEL

Il file Excel generato contiene:

1. **DettaglioBlocchi:** Tutti i blocchi con:
   - DATA, APT, ASSISTENTE
   - TURNO (originale e normalizzato)
   - INIZIO_DT, FINE_DT
   - DURATA_TURNO_MIN
   - ATD_SCELTO
   - TURNO_EUR, EXTRA_MIN, EXTRA_EUR
   - NOTTE_MIN, NOTTE_EUR
   - FESTIVO
   - TOTALE_BLOCCO_EUR
   - SRC_FILE, SRC_SHEET, SRC_ROW0

2. **TotaliPeriodo:** Riepilogo per:
   - Periodo 1-15
   - Periodo 16-31
   - Totale mensile

3. **Discrepanze:** Eventuali differenze con valori forniti nel file originale

4. **Assistenti_VRN:** Calcoli per assistenti VRN (se presenti)

---

**Documento aggiornato:** Dicembre 2025  
**Versione:** 1.0

